<script data-require="jquery@3.1.1" data-semver="3.1.1" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-10">
        <div class="menuNav">
            <button class="btn" onclick="window.location.href='/menu/updateMenu'">Table View (Edit)</button>
            <button class="btn" onclick="window.location.href='/menu'" >User View</button>
            <button class="btn" style="cursor: not-allowed;">Menu Statistics</button>
        </div>
        <div class="FDefaultTab menuGraph">
            <canvas id="myChart"></canvas>
        </div>
        <div class="FDefaultTab menuGraph">
            <canvas id="myChart2"></canvas>
        </div>
    </div>
    <div class="col-md-1">
    </div>
</div>

<script>
    $(function() {
        fetch('/menu/getStatData', {
            headers: {
                "Content-Type": "application/json"
            },
        })
        .then(response => {
            console.log(response);
            return response.json();
        })
        .then(data => {
            console.log(data);
            const labels = data.menus.map(f => f.name);
            const orderList = data.orders.map(f => f.food.map(o => o.id));
            const newList = [];
            for (i=0; i<orderList.length;i++) {
                for (j=0; j<orderList[i].length;j++) {
                    newList.push(orderList[i].pop())
                }
            }
            const dataList = []
            data.menus.forEach((menu) => {
                if (newList.indexOf(menu.id.toString()) >= 0) {
                    dataList.push(newList.map(n => n == menu.id).length);
                } else {
                    dataList.push(0)
                }
            })
            const dataStat = {
                labels: labels,
                datasets: [{
                    label: 'Orders',
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: dataList,
                }]
            };
            const config = {
                type: 'line',
                data:dataStat,
                options: {
                    plugins: {
                        title: {
                            display: true,
                            font: { weigth: 'bold', size: 20 },
                            text: 'Amount of orders for each food'
                        }
                    }
                }
            };
            var myChart = new Chart(
                document.getElementById('myChart'),
                config
            );
            const dataList2 = []
            for (i=1;i<13;i++) {
                dataList2.push((data.orders.filter(f => parseInt(f.date.substr(5, 2)) == i )).length);
            }
            console.log(dataList2)
            const dataStat2 = {
                labels: [1,2,3,4,5,6,7,8,9,10,11,12],
                datasets: [{
                    label: 'Orders',
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: 'rgb(255, 99, 132)',
                    data: dataList2,
                }]
            };
            const config2 = {
                type: 'line',
                data: dataStat2,
                options: {
                    plugins: {
                        title: {
                            display: true,
                            font: { weigth: 'bold', size: 20 },
                            text: 'Amount of monthly orders'
                        }
                    }
                }
            };
            var myChart2 = new Chart(
                document.getElementById('myChart2'),
                config2
            );
        })
        .catch(err => console.error(err));
    })

</script>